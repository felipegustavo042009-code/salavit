<div class="panel-page teacher-panel">
    <div class="panel-header">
        <h1><i class="fas fa-chalkboard-teacher"></i> Painel do Professor</h1>

        <!-- Room Code Display -->
        <div class="room-code-display">
            <div class="code-info">
                <span class="code-label">Código da Sala:</span>
                <span class="code-value" id="teacher-room-code">------</span>
            </div>
            <div class="room-status">
                <i class="fas fa-circle status-indicator active"></i>
                <span class="student-count">(<span id="connected-students">0</span> alunos conectados)</span>
            </div>
        </div>
    </div>

    <div class="panel-grid">
        <!-- Gerar QR Code -->
        <div class="panel-card" onclick="gerarQRCode()">
            <div class="card-icon">
                <i class="fas fa-qrcode"></i>
            </div>
            <h3>Gerar QR Code</h3>
            <p>Crie QR Code para acesso à sala</p>
        </div>

        <!-- Mãos Levantadas -->
        <div class="panel-card" onclick="abrirSecaoNormal('raised-hands-section', 
        () => {
        if (window.GerenciadorMaoLevantada) {
            GerenciadorMaoLevantada.carregarMaosLevantadas();
        }})">
            <div class="card-icon">
                <i class="fas fa-hand-paper"></i>
            </div>
            <h3>Mãos Levantadas</h3>
            <p>Veja quem quer falar</p>
        </div>

        <!-- Atividades -->
        <div class="panel-card" onclick="abrirSecaoNormal('teacher-activities-section',  
        () => {
        if (window.sistemaAtividades) {
            window.sistemaAtividades.carregarAtividades();
        }})">
            <div class="card-icon">
                <i class="fas fa-tasks"></i>
            </div>
            <h3>Atividades</h3>
            <p>Crie e gerencie atividades</p>
        </div>

        <!-- Materiais -->
        <div class="panel-card" onclick="abrirSecaoNormal('materials-section',
        () => {
        if (window.sistemaMateriais) {
            window.sistemaMateriais.carregarMateriais();
        }})">
            <div class="card-icon">
                <i class="fas fa-file-alt"></i>
            </div>
            <h3>Materiais</h3>
            <p>Envie e gerencie materiais da sala</p>
        </div>

        <!-- Quizzes -->
        <div class="panel-card" onclick="abrirSecaoNormal('quiz-section',
        () => {
        if (window.sistemaQuiz) {
            window.sistemaQuiz.carregarQuizzes();
        }})">
            <div class="card-icon">
                <i class="fas fa-question-circle"></i>
            </div>
            <h3>Quizzes</h3>
            <p>Crie e gerencie quizzes</p>
        </div>
    </div>

    <!-- Seções de conteúdo -->
    <div class="content-sections">
        <!-- QR Code Section -->
        <div class="content-section" id="qr-code-section" style="display: none;">
            <div class="section-header">
                <h2>QR Code</h2>
                <button class="btn btn-secondary fechar" onclick="fecharTodasSecoes()">
                    <i class="fas fa-times"></i> Fechar
                </button>
            </div>
            <div class="qr-code-content">
                <div class="qr-code-display">
                    <div class="qr-code-container" id="qr-code-container">
                        <!-- QR Code will be generated here -->
                    </div>
                    <div class="qr-code-info">
                        <p><strong>Código da Sala:</strong> <span id="qr-room-code">------</span></p>
                    </div>
                </div>
                <div class="qr-code-actions">
                    <button class="btn btn-primary" onclick="baixarQRCode()">
                        <i class="fas fa-download"></i>
                        Baixar QR Code
                    </button>
                </div>
            </div>
        </div>

        <!--  Atividade Section -->
        <div class="content-section activities-section container-simples" id="teacher-activities-section"
            style="display: none;">
            <div class="activities-header">
                <h2>Gerenciar Atividades</h2>
                <div class="activities-actions">
                    <button class="btn-create" data-action="create-activity">
                        <i class="fas fa-plus"></i>
                        Criar
                    </button>
                    <button class="btn btn-secondary" onclick="fecharTodasSecoes()">
                        <i class="fas fa-times"></i>
                        Fechar
                    </button>
                </div>
            </div>
            <div class="activities-list" id="teacher-activities-list">
                <!-- Lista de atividades será carregada aqui -->
            </div>
        </div>

        <!-- Maos Section -->
        <div class="content-section" id="raised-hands-section" style="display: none;">
            <div class="section-header">
                <h2>Mãos Levantadas</h2>
                <div class="section-actions">
                    <button class="btn btn-create limpar" onclick="window.GerenciadorMaoLevantada.limparTodasMaos()">
                        <i class="fas fa-eraser"></i>
                        Limpar
                    </button>
                    <button class="btn btn-secondary fechar" onclick="fecharTodasSecoes()">
                        <i class="fas fa-times"></i>
                        Fechar
                    </button>
                </div>
            </div>
            <div class="raised-hands-list"></div>
        </div>

        <!-- Materials Section -->
        <div class="content-section" id="materials-section" style="display: none;">
            <div class="section-header">
                <h2><i class="fas fa-file-alt"></i> Materiais</h2>
                <div class="section-actions">
                    <button class="btn btn-create" data-action="enviar-material">
                        <i class="fas fa-plus"></i> Criar
                    </button>
                    <button class="btn btn-secondary fechar" onclick="fecharTodasSecoes()">
                        <i class="fas fa-times"></i> Fechar
                    </button>
                </div>
            </div>
            <div class="materials-list" id="teacher-materials-list">
                <!-- Lista de materiais do professor será carregada aqui -->
            </div>
        </div>

        <!--  Atividades Section -->
        <div class="content-section activities-section container-simples" id="quiz-section" style="display: none;">
            <div class="quiz-header">
                <h2>Gerenciar Quizzes</h2>
                <div class="quiz-header-actions">
                    <button class="btn-create" id="btn-criar-quiz">
                        <i class="fas fa-plus"></i>
                        Criar
                    </button>
                    <button class="btn btn-secondary" onclick="fecharTodasSecoes()">
                        <i class="fas fa-times"></i>
                        Fechar
                    </button>
                </div>
            </div>
            <div class="quiz-list" id="teacher-quiz-list">
                <!-- Lista de quizzes será carregada aqui -->
            </div>
        </div>

        <!-- Pessoas Conetadas -->
        <div class="content-sectionfixo" id="connected-students-section">
            <div class="section-header">
                <h2></h2>
                <div class="section-actions">
                </div>
                <div class="response-counter" id="response-counter">
                    <!-- Contador será inserido aqui -->
                </div>
            </div>
            <div class="connected-students-list" id="connected-students-list">
                <!-- Lista de alunos será gerada aqui -->
            </div>
        </div>


    </div>
</div>

<!-- Enviar Material Modal -->
<div class="modal activity-modal" id="enviar-material-modal" style="display: none;">
    <div class="activity-modal-content">
        <div class="activity-modal-header">
            <h3 class="modal-title">Enviar Material</h3>
            <button class="close-modal-btn" onclick="window.SistemaMateriais.fecharModalMaterial()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <form class="enviar-material-form" id="enviar-material-form">
            <div class="form-group">
                <label for="material-title">Título do Material</label>
                <input type="text" id="material-title" class="form-input" placeholder="Digite o título do material"
                    required>
            </div>

            <div class="form-group">
                <label for="material-description">Descrição</label>
                <textarea id="material-description" class="form-textarea"
                    placeholder="Descreva o material e seu conteúdo" required></textarea>
            </div>

            <div class="form-group">
                <label for="material-file">Arquivo</label>
                <input type="file" id="material-file" class="form-input" accept="/*" required>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-secondary" data-action="fechar-modal-material">
                    Cancelar
                </button>
                <button type="button" class="btn btn-primary" data-action="salvar-material">
                    <i class="fas fa-upload"></i> Enviar Material
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Enviar atividaed Modal -->
<div class="modal activity-modal" id="create-activity-modal" style="display: none;">
    <div class="activity-modal-content">
        <div class="activity-modal-header">
            <h3 class="modal-title">Nova Atividade</h3>
            <button class="close-modal-btn" onclick="sairAtividade()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <form class="create-activity-form" id="create-activity-form">
            <div class="form-group">
                <label for="activity-title">Título da Atividade</label>
                <input type="text" id="activity-title" class="form-input" placeholder="Digite o título da atividade"
                    required>
            </div>

            <div class="form-group">
                <label for="activity-description">Descrição</label>
                <textarea id="activity-description" class="form-textarea"
                    placeholder="Descreva a atividade e as instruções para os alunos" required></textarea>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="activity-type">Tipo</label>
                    <select id="activity-type" class="form-select" required>
                        <option value="" selected disabled>Selecione o tipo</option>
                        <option value="tarefa">Tarefa</option>
                        <option value="trabalho">Trabalho</option>
                        <option value="prova">Prova</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="activity-due-date">Prazo</label>
                    <input type="datetime-local" id="activity-due-date" class="form-input">
                </div>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-secondary" data-action="close-modal">
                    Cancelar
                </button>
                <button type="button" class="btn btn-primary" data-action="save-activity">
                    <i class="fas fa-save"></i>
                    Criar Atividade
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Respostas da Atividade Modal  -->
<div class="modal activity-modal" id="activity-responses-modal" style="display: none;">
    <div class="activity-modal-content">
        <div class="activity-modal-header">
            <h3 class="modal-title">Respostas da Atividade</h3>

            <button class="close-modal-btn" data-action="close-modal">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="responses-content">
            <!-- Conteúdo das respostas será carregado aqui -->
        </div>
    </div>
</div>

<!-- Quiz Modal -->
<div class="quiz-modal activity-modal" id="quiz-edicao-section" style="display: none;">
    <div class="quiz-modal-content activity-modal-content">
        <div class="quiz-edicao-header">
            <h2 class="quiz-edicao-titulo" id="quiz-edicao-nome">Novo Quiz</h2>
            <div class="quiz-edicao-acoes">
                <button class="btn-create" id="btn-salvar-quiz">
                    <i class="fas fa-save"></i>
                    Salvar Quiz
                </button>
                <button class="btn btn-secondary" id="btn-fechar-quiz">
                    <i class="fas fa-times"></i>
                    Fechar
                </button>
            </div>
        </div>
        <!-- Barra de cards de perguntas -->
        <div class="quiz-barra-perguntas">
            <button class="quiz-btn-adicionar" id="btn-adicionar-pergunta-quiz" title="Adicionar pergunta">
                +
            </button>
            <div id="quiz-cards-perguntas" style="display: flex; gap: 0.5rem; flex-wrap: nowrap;">
                <!-- Cards numerados serão gerados aqui -->
            </div>
        </div>
        <!-- Área de edição da pergunta atual -->
        <div class="quiz-area-pergunta">
            <div id="quiz-formulario-pergunta">
                <!-- Formulário da pergunta será renderizado aqui -->
            </div>
        </div>
    </div>
</div>
<!-- Quiz Modal -->
<div class="modal quiz-modal activity-modal" id="criar-quiz-modal" style="display: none;">
    <div class="quiz-modal-content activity-modal-content">
        <div class="quiz-modal-header activity-modal-header">
            <h3 class="quiz-modal-titulo modal-title">Novo Quiz</h3>
            <button class="close-modal-btn" id="btn-cancelar-novo-quiz">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <form class="create-activity-form" onsubmit="return false;">
            <div class="form-group">
                <label for="quiz-titulo-input">Nome do Quiz</label>
                <input type="text" id="quiz-titulo-input" class="form-input" placeholder="Digite o nome do quiz"
                    required>
            </div>
            <div class="form-group">
                <label for="quiz-qtd-perguntas-input">Quantidade inicial de perguntas</label>
                <input type="number" id="quiz-qtd-perguntas-input" class="form-input" placeholder="Ex: 5" min="1"
                    max="50" value="1" required
                    onkeydown="return event.key !== 'e' && event.key !== 'E' && event.key !== '.'  && event.key !== '-'  && event.key !== '+'">
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" id="btn-cancelar-novo-quiz">
                    Cancelar
                </button>
                <button type="button" class="btn btn-primary" id="btn-confirmar-novo-quiz">
                    <i class="fas fa-arrow-right"></i>
                    Continuar
                </button>
            </div>
        </form>
    </div>
</div>

<script type="module">
    import { GerenciadorMaoLevantada } from '../js/sistema-mao.js';

    document.addEventListener('DOMContentLoaded', () => {
        GerenciadorMaoLevantada.inicializar();
        if (EstadoSala.isTeacher && EstadoSala.roomCode) {
            GerenciadorSala.escutarAtualizacoesSala();
            GerenciadorSala.atualizarDisplayAlunosConectados();
        }
    });

    window.GerenciadorMaoLevantada = GerenciadorMaoLevantada;
    window.reconhecerMao = GerenciadorMaoLevantada.reconhecerMao;
</script>

<script type="module">
    import { SistemaAtividades } from '../js/sistema-atividade.js';

    document.addEventListener('DOMContentLoaded', () => {
        if (!window.sistemaAtividades) {
            window.sistemaAtividades = new SistemaAtividades();
        }
    });
</script>

<script type="module">
    import SistemaMateriais from '../js/materiais.js';

    document.addEventListener('DOMContentLoaded', () => {
        if (!window.sistemaMateriais) {
            window.sistemaMateriais = new SistemaMateriais();
        }
    });
</script>

<script type="module">
    import VisualizadorRespostasQuiz from '../js/quiz.js';

    document.addEventListener('DOMContentLoaded', () => {
        if (!window.visualizadorRespostasQuiz) {
            window.visualizadorRespostasQuiz = new VisualizadorRespostasQuiz();
        }
    });
</script>